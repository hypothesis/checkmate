#!/usr/bin/env sh

set -eu

if [ -z "${CHECKMATE_BLOCKLIST_URL:-}" ]; then
  echo "Skipping blocklist fetch. No CHECKMATE_BLOCKLIST_URL env var is configured."
  exit 0
fi

if [ -z "${CHECKMATE_BLOCKLIST_PATH:-}" ]; then
  echo "Skipping blocklist fetch. No CHECKMATE_BLOCKLIST_PATH env var is configured."
  exit 0
fi

echo "Fetching blocklist from $CHECKMATE_BLOCKLIST_URL as $CHECKMATE_BLOCKLIST_PATH"
curl --silent --max-time 5 $CHECKMATE_BLOCKLIST_URL > $CHECKMATE_BLOCKLIST_PATH.new
mv $CHECKMATE_BLOCKLIST_PATH.new $CHECKMATE_BLOCKLIST_PATH
